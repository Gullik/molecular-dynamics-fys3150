
\documentclass[11pt]{article}
\usepackage{verbatim}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{a4wide}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[dvips]{epsfig}
\usepackage[T1]{fontenc}
\usepackage{cite} % [2,3,4] --> [2--4]
\usepackage{shadow}
\usepackage{hyperref}
\usepackage{physics}
\usepackage{url}

\setcounter{tocdepth}{2}

\lstset{language=c++}
\lstset{alsolanguage=[90]Fortran}
\lstset{basicstyle=\small}
\lstset{backgroundcolor=\color{white}}
\lstset{frame=single}
\lstset{stringstyle=\ttfamily}
\lstset{keywordstyle=\color{red}\bfseries}
\lstset{commentstyle=\itshape\color{blue}}
\lstset{showspaces=false}
\lstset{showstringspaces=false}
\lstset{showtabs=false}
\lstset{breaklines}

\title{ Molecular Dynamics \\ FYS-3150 }
\author{Gullik Vetvik Killie }

\begin{document}

\maketitle

\tableofcontents

\newpage
Notes
\begin{itemize}
\item Is it not the Leapfrog algorithm?
\item Need to invent some unit test to implement, ask for ideas
\item Is it necessary to compute potential? Analytical form of force should be enough. Loss of computing speed when not caring about potential
\item Dipoles? Should form crystals
\item Magnetic force
\item Different molecules
\item Crystals mixed with liquids
\item Unit Test, check that it stays stable if temp is zero, then forces should be zero for crystal configuration.
\end{itemize}

\section{Task a: Periodic boundary conditions}
	This task was implemented in the function applyPeriodicBoundaryConditions() and the program can be found at the github page \cite{myGit}.
\\ \\
	\noindent Since we have limited computational power we are only working on a small piece of argon material, to get away from boundary cases we simulate a system of infinite size by implementing periodic boundary conditions. This is done by confining the atoms in a box and each time a particle reaches the end of the box it is put to the other side.

\section{Task b: Removing momentum}
	This task is implemented in the function removeMomentum().
\\ \\
	\noindent Since all the atoms are given random velocities the net momentum is not zero and the cloud will drift. This is solved by calculating the total momentum of all the atoms, and then subtracting a fraction of the total momentum from each atom so the total momentum ends up being zero.

\section{Task c: Putting the atoms on a lattice}
	This task is implemented in the function createFCCLattice()
\\ \\
	\noindent The noble gas argon should have a stable lattice structure when a solid, by letting the system start in a stable situation we avoid a lot of energy to be infused into the systems temperature due to it minimizing potential energy. The implementation is done by going through several nodes, \(R_i\), put on a grid in the box and then placing 4 atoms around each node. Let \(c_l\) be the length between nodes.

	\begin{align*}
	\vb{R}_{ij} = \vb{R}_i + \vb{r}_j \qquad{j }= \{1,2,3,4\} \qquad{i = }\{1,2, ... , 4\text{N}_{\text{atoms}}\}
	\end{align*}

	\begin{align*}
		\vb{r}_1 &= 0 \vu{i} + 0 \vu{j} + 0 \vu{k}
		\\
		\vb{r}_2 &= \frac{c_l}{2} \vu{i} + \frac{c_l}{2} \vu{j} + 0 \vu{k}
		\\
		\vb{r}_3 &= 0 \vu{i} + \frac{c_l}{2} \vu{j} + \frac{c_l}{2} \vu{k}
		\\
		\vb{r}_4 &= \frac{c_l}{2} \vu{i} + 0 \vu{j} + \frac{c_l}{2} \vu{k}
	\end{align*}


\section{Task d: Implementing a Verlet integrator}
	Se subsection \ref{sub:verlet}

\section{Task e: Computing forces}
	See subsection \ref{sub:potential}

\section{Task f: Calculating some statistical properties}
	\subsubsection{Kinetic energy}

		The kinetic energy is found trough adding up the kinetic energy for all the atoms separately. It is straight forward and done in a function, in the statisticsSampler class, called sampleKineticEnergy(). It goes through all the atoms and adds it's contribution to the total kinetic energy. 

		\[
		E_k = \sum\limits^{N_{atoms}}_{i=1}{\frac{1}{2}m_i v_i^2}
		\]

		\noindent Then it also stores the instantaneous temperature of the substance which is given by the equipartition theorem \( \langle E_K \rangle = \frac{2}{3} k_B N_{atoms} T \). By looking at the kinetic energy in a time-instant instead of averaging it we get an instantaneous temperature.
\\ \\
		\noindent All of this is stored together with the potential energy to a text file "./statisticalResults/statisticalValues.tsv" which can be plotted by the python program plots.py.

\section{Task g: implementing Neighbor cells}
	\begin{table}
		\begin{tabular}{| c | c | c | c | c | c | c | c | c |}
		\hline
			\(N_{atoms}\)	&	4 			&	32			&	108			&	256		&	500		&	864		& 1372		&	2048
			\\ \hline
			time (s)		&	0.003539	&	0.054251	&	0.274064	&	1.22426	&	3.96325	&	11.3712	& 28.3554	& 62.9434 
			\\ \hline
			time (s) with list & -			& 0.179424		&	1.74696		&	2.89621	&	9.14402	&	13.3765	& 33.5662	& 39.6798
			\\ \hline
		\end{tabular}
	\label{tab:time_spent}
	\caption{This table shows time to compute 100 timesteps with different amount of atoms in the model. The time is increasing much faster than linearly. After the neighborlists are implemented it is slower on very few atoms, but it grows slower and spends less time aabove 2048 atoms.}
	\end{table}

	Table \ref{tab:time_spent} shows the time spent computing with different amount of atoms in the system, as the system increases the time is increasing fast and we can see the need to implement neighbor cells. The time is increasing fast because the program has to calculate the forces between all the atoms and that is of the order \(\order{N^2}\). By only calculating the nearby atoms, which will be the ones affecting each other the most, the time taken will mostly increase linearly.
\\ \\
	\noindent The force is mostly ignorable outside a distance of \(3 \sigma \), see figure \ref{fig:force}.

	\begin{itemize}
		\item Divide box into smaller boxes with \(l >3\sigma\), and put the cell layer class between the system and atoms.
				\[\text{system} \rightarrow\text{cellbox} \rightarrow \text{atoms}\]
		\item For each box go through all the boxes neighboring boxes. Boxes should be stored in three lists as \((i,j,k)\) and the neighboring boxes to box \((i,j,k)\) are \( (i-1, j-1, k-1), (i-1,j-1,k) \) and going through all the combinations to \( (i+1,j+1,k+1) \)
		\item Each atom needs an additional box assignment property
		\item Calculate the forces for all the atoms belonging to the neighboring boxes
	\end{itemize}

	



	\begin{figure}
		\includegraphics[scale = 0.5]{forcePlot}
		\label{fig:force}
		\caption{A picture over the force felt between two particles due to the Lennard-Jones potential. At approximately 3 \(\sigma\) of length the magnitude of the force closes to zero and we can ignore the contribution of atoms further away from each other.}
	\end{figure}



\section{Theory}
	\subsection{Verlet integrator}
		\label{sub:verlet}
		The Integrator is a widely used integrator in  molecular dynamics \cite{compPhys} because of it's properties as a symplectic integrator which means that it conserves areas in phase space very well and it allows stable integration of the equation of motion \cite{aBInitio}. Newton's second law for for a particle in our molecule ensemble reads:

		\[m\pdv[2]{x_{i}}{t} = F_{i}\]

		\[\pdv{x_{i}}{t} = v_{i} \text{     and     } \pdv{v_{i}}{t} = \frac{F_{i}}{m} \]

		The Leapfrog algorithm is a slight continuation on the Verlet algorithm doing the step in two steps. Doing a Taylor expansion around both the step and half the step we get.
	

		\begin{align}
			x_{i}(t+h) &= x_i(t) + hx_i'(t) + \frac{h^2}{2}x_i''(t) + \order{h^3} \label{eq:leapfrog_start}
			\\
			x_i'(t+ \frac{h}{2} ) &= x_i'(t) + \frac{h}{2} x_i''(t) + \order{h^2} \label{eq:leapfrog_half}
		\end{align}	

		\noindent Inserting equation \eqref{eq:leapfrog_half} into \eqref{eq:leapfrog_start} to obtain

		\begin{equation}
		x_{i}(t+h) = x_i(t) + hx_i'(t+ \frac{h}{2})+ \order{h^3} \label{eq:leapfrog_pos_step}
		\end{equation}

		\noindent A Taylor first order expansion of the velocity produces the following

		\begin{align}
			x'_i(t+\frac{h}{2}) &= x_i'(t)  + \frac{h}{2}x_i''(t) + \order{h^2} \label{eq:leapfrog_vel_step}
		\end{align}

		\noindent By using equation \eqref{eq:leapfrog_vel_step}, then \eqref{eq:leapfrog_pos_step} and then \eqref{eq:leapfrog_vel_step} again we obtain \(x_i(t+h)\) and \(v_i(t+h)\). The algorithm follows:

		\begin{align*}
		v_i(t+\frac{h}{2}) &= x_i'(t)  + \frac{h}{2}\frac{F_i(t)}{m} + \order{h^2} 
		\\
		x_i(t+h) &= x_i(t) + hx_i'(t+ \frac{h} {2} ) + \order{h ^ 3}
		\\
		v_i(t+h) &= v_i(t+\frac{h}{2})  +  \frac{h}{2}\frac{F_i(t+ \frac{h}{2})}{m} + \order{h^2} 
		\end{align*}


	\subsection{Lennard-Jones Potential and force between two molecules}
		\label{sub:potential}
		We will be using the Lennard-Jones potential to approximate the forces between the molecules, which work quite well, given it's simplicity, for neutral particles, especially noble gases, as we are dealing with in this study \cite{Wiki}. The formula is given below.

		\[
		U(r_{ij}) = 4 \epsilon \left[ \left( \frac{\sigma}{r_{ij}} \right)^{12} - \left( \frac{\sigma}{r_{ij}} \right)^{6} \right]
		\]
		
		At short distances the term to the twelfth power dominates and represents a repulsive force, Paulie exclusion principle, while at longer distances the term to sixth power dominates and represents the attractive van der Waal force. The \(\sigma \) is the distance at which the potential is \(0\), while \( \epsilon  \) is the depth of the well. \\
		Experimentally the following values for argon has been found: 
		\(
		\begin{cases}
		\epsilon/k_B &= 119.8 \text{K} 
		\\
		\sigma &= 3.405 \text{\AA}
		\end{cases}
		\)


		\noindent The force felt between the molecules is given by the negative gradient of the potential.

		\begin{align*} 
		\vb{F}(r_{ij}) &= -\grad U(r_{ij})
		\intertext{The potential only has a nonzero derivative along \( \vb{r}_{ij} \), the  axis between then particles, so it is natural to evaluate the gradient in that coordinate system before projecting it onto the xyz coordinates used by the program.}
		\\
		\vb{F} (r_{ij}) &= - 4 \epsilon \vu{r}_{ij} \partial_{r_{ij}}  \left[ \left( \frac{\sigma}{r_{ij}} \right)^{12} - \left( \frac{\sigma}{r_{ij}} \right)^{6} \right]
		\\
		\vb{F} (r_{ij}) &=- 4 \epsilon \vu{r}_{ij} \left[ \left( -\frac{12}{\sigma} \right) \left( \frac{\sigma}{r_{ij}}  \right)^{13} 
		- \left( - \frac{6}{\sigma}  \right)\left( \frac{\sigma}{r_{ij}} \right)^{7} \right]
		\intertext{Then it is projected onto the xyz coordinates, 
		\( F_k = \left(F\frac{r_{ij}}{\abs{r_{ij}}}\right)_k= F\frac{k_{ij}}{\abs{r_{ij}}} \), where \( k_{ij} \) is the distance between the particles in direction \(k = \{x,y,z\}\) , and \( \abs{r_{ij}} \) is the total distance.
		}
		F_k &=  \frac{24}{\sigma} \epsilon \left[ 2  \left( \frac{\sigma}{r_{ij}}  \right)^{13} 
		- \left( \frac{\sigma}{r_{ij}} \right)^{7} \right]\frac{k_{ij}}{\abs{r_{ij}}}
		\end{align*}

	\subsubsection{Algorithm to implement force}
		The implementation of the force will be along the following steps:
		\begin{itemize}
		\item Calculate \(r_{ij} = \abs{\vb{r}_i - \vb{r}_j}\) for a particle pair
		\item Calculate \(F_{r_{ij}} =  \frac{24}{\sigma} \epsilon \left[ 2  \left( \frac{\sigma}{r_{ij}}  \right)^{13} 
		- \left( \frac{\sigma}{r_{ij}} \right)^{7} \right]\)
		\item Calculate \(F_x = F_{r_{ij}} \frac{k_{ij}}{\abs{r_{ij}}} \) for xyz
		\item Add the force to both particles force account, halves the necessary computations. One positive one negative
		\end{itemize}
		

	\appendix
	\section{Unit scheme}
		The program uses a more natural set of units which let's Boltzmann's constant be 1.

		\begin{align}
			1 \text{ mass unit } &= 1 \text{ a.m.u } = 1.661\cross 10^{-27} \text{ kg}
			\\
			1 \text{ length unit } &= 1.0 Ã… = 1.0\cross 10^{-10} \text{ m}
			\\
			1 \text{ energy unit } &= 1.651 \cross 10^{-21} \text{ J}
			\\
			1 \text{ temperature unit } &= 119.735 \text{ K}
		\end{align}


	All the other units are then expressed in term of these units.

	Boltzmann constant translates between temperature and energy, in SI-units it is \( k_B = 1.381 \cross 10^{-23} \text{ J K}^{-1}\), which in the previously defined units becomes
	\begin{align}
	k_B &= 1.381 \cross 10^{-23}  \left(\text{ J K}^{-1}\right)  \left(\frac{\text{energy unit}}{1.651 \cross 10^{-21} \text{ J}}\right)
	\left( \frac{119.735 \text{ K}}{\text{temperature unit}} \right)
	\\
	k_B &= 1 \; \frac{\text{energy unit}}{\text{temperature unit}}
	\end{align}


\bibliography{mybib}{}
\bibliographystyle{plain}
		
\end{document}
